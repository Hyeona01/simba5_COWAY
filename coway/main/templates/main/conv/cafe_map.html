{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/conv/conv_map.css' %}?after">

<section id="title">
    <div class="back_icon"> <a href="{% url 'convpage' %}"><i class="fas fa-chevron-left"></i></a></div>
    <div class="title_name">카페</div>
</section>

<!-- <section id="map">
    <img src="{% static 'images/임시.png' %}" alt="지도">
</section> -->

<section id="main_img">
    <!-- <div id="map" style="width:318px;height:237px;"></div> -->
    <div id="map"></div>
</section>

<section id="popup" style="display: none;">
    <div class="popup_info">
        <p class="info_content">각 편의시설 사진 및 정보</p>
        <button type="button" class="btn_close">닫기</button>
    </div>
</section>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=33ccb9ed924f4f71c3407b8f585df918"></script>
<script>
    var container = document.getElementById('map');
    var options = {
        center: new kakao.maps.LatLng(37.5582, 127.0006),
        level: 3
    };

    var map = new kakao.maps.Map(container, options);

    var positions = [
        {
            title: '가온누리카페',
            location: '1관 00층 앞',
            latlng: new kakao.maps.LatLng(37.5583, 126.9996),
            time: '월화수목금 00시~00시'
        },
        {
            title: '그루터기',
            location: '2관 00층 앞',
            latlng: new kakao.maps.LatLng(37.55700, 127.0027),
            time: '월화수목금 00시~00시'
        },
        {
            title: '남산학사 카페',
            location: '3관 00층 앞',
            latlng: new kakao.maps.LatLng(37.5584, 126.99825),
            time: '월화수목금 00시~00시'
        },
        {
            title: '블루포트',
            location: '4관 00층 앞',
            latlng: new kakao.maps.LatLng(37.5589, 126.9999),
            time: '월화수목금 00시~00시'
        },
        {
            title: 'ing카페',
            location: '5관 00층 앞',
            latlng: new kakao.maps.LatLng(37.55700, 127.0027),
            time: '월화수목금 00시~00시'
        }
    ];

    var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

    for (var i = 0; i < positions.length; i++) {

        var imageSize = new kakao.maps.Size(24, 35);

        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
        var marker = new kakao.maps.Marker({
            map: map,
            position: positions[i].latlng,
            title: positions[i].title,
            image: markerImage
        });

        // 팝업
        // 닫기 말고 x 버튼으로 추가해야 됨
        var convInfo = positions[i].title + '\n' + positions[i].location;
        console.log(convInfo);
        document.querySelector('.info_content').textContent = convInfo;

        var popUp = document.querySelector('#popup');
        var closeBtn = document.querySelector('.btn_close');

        kakao.maps.event.addListener(marker, 'click', function(){
            popUp.style.display = 'block';
        });
        closeBtn.addEventListener('click', function(){
            this.parentNode.parentNode.style.display = 'none';
        });


        // 오버레이
        var overlay = new kakao.maps.CustomOverlay({
            content: positions[i].location,
            map: map,
            position: marker.getPosition()
        });

        // 인포윈도우
        // var infowindow = new kakao.maps.InfoWindow({
        //     content: positions[i].title
        // });
    };
</script>

{% endblock %}